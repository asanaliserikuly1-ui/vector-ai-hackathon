{% extends "base.html" %}
{% block title %}Onboarding ‚Äî VECTOR AI{% endblock %}

{% block content %}
<section class="ob-wrap onboarding-fix">

  <div class="ob-hero">

    <div class="ob-card">

      <!-- Left: main -->
      <div class="ob-main">

        <div class="ob-head">
          <h1 class="ob-title">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç <span class="ob-emoji">üöÄ</span></h1>
          <p class="ob-sub">–ó–∞–ø–æ–ª–Ω–∏ –∫–æ—Ä–æ—Ç–∫—É—é –∞–Ω–∫–µ—Ç—É ‚Äî –∏ –Ω–∞—á–Ω–∏ AI-–∏–Ω—Ç–µ—Ä–≤—å—é.</p>

          <div class="ob-progress" aria-label="progress">
            <div class="ob-progress-fill" style="width: 28%;"></div>
          </div>
        </div>

        <form method="post" class="ob-form" id="obForm">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <!-- Name -->
          <div class="ob-field">
            <label class="ob-label">–ò–º—è <span class="ob-hint">‚ú¶</span></label>
            <div class="ob-inputwrap">
              <input class="ob-input" name="full_name" value="{{ profile.full_name or '' }}"
                     placeholder="–ù–∞–ø—Ä: –ò–º–∞–Ω–∞–ª–∏" required>
              <span class="ob-ok" aria-hidden="true">‚úì</span>
            </div>
          </div>

          <!-- Row: region + remote -->
          <div class="ob-row">
            <div class="ob-field">
              <label class="ob-label">–ì–æ—Ä–æ–¥ / —Ä–µ–≥–∏–æ–Ω</label>
              <div class="ob-inputwrap ob-inputwrap-icon">
                <span class="ob-icon">üìç</span>
                <input class="ob-input" name="region" value="{{ profile.region or '–ê–ª–º–∞—Ç—ã' }}" placeholder="–ê–ª–º–∞—Ç—ã">
                <span class="ob-caret" aria-hidden="true">‚ñæ</span>
              </div>
            </div>

            <div class="ob-field">
              <label class="ob-label">–£–¥–∞–ª—ë–Ω–∫–∞</label>
              <label class="ob-toggle">
                <input type="checkbox" name="remote" {% if profile.remote %}checked{% endif %}>
                <span class="ob-switch" aria-hidden="true"></span>
                <span class="ob-toggle-text">–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é —É–¥–∞–ª—ë–Ω–∫—É</span>
              </label>
            </div>
          </div>

          <!-- Roles chips -->
          <div class="ob-field">
            <label class="ob-label">–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ (1‚Äì3 —Ä–æ–ª–∏)</label>

            <!-- chips container -->
            <div class="ob-chips" id="chips">
              <!-- chips will render here -->
              <button class="ob-chip ob-chip-add" type="button" id="chipAddBtn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <div class="ob-help">–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–∞—Ä–±–µ—Ä, –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥, –î–∏–∑–∞–π–Ω–µ—Ä</div>

            <!-- IMPORTANT: this is the backend field -->
            <input class="ob-input ob-input-hidden" id="rolesInput"
                   name="roles"
                   value="{{ (profile.roles or [])|join(', ') }}"
                   placeholder="–ë–∞—Ä–±–µ—Ä, SMM, Data Analyst...">
          </div>

          {# —Å–∫—Ä—ã—Ç—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã, —á—Ç–æ–±—ã —Ç–≤–æ–π backend –Ω–µ –ª–æ–º–∞–ª—Å—è #}
          <input type="hidden" name="city" value="{{ profile.city or '' }}">
          <input type="hidden" name="college" value="{{ profile.college or '' }}">
          <input type="hidden" name="speciality" value="{{ profile.speciality or '' }}">
          <input type="hidden" name="start_year" value="{{ profile.start_year or '' }}">
          <input type="hidden" name="job_intent" value="{{ profile.job_intent or 'maybe' }}">
          <input type="hidden" name="notify" value="">

          <!-- CTA -->
          <button class="ob-cta" type="submit">
            <span class="ob-cta-ico">‚úà</span>
            –ù–∞—á–∞—Ç—å AI-–∏–Ω—Ç–µ—Ä–≤—å—é <span class="ob-cta-arr">‚Üí</span>
          </button>

          <!-- meta row -->
          <div class="ob-meta">
            <div class="ob-meta-left">‚úì –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ò–ò —É—Ç–æ—á–Ω–∏—Ç –≤ –¥–∏–∞–ª–æ–≥–µ</div>
            <div class="ob-meta-right">
              <span class="ob-pill"><span class="ob-pill-ico">üõ°</span> –ë–µ–∑–æ–ø–∞—Å–Ω–æ</span>
              <span class="ob-pill"><span class="ob-pill-ico">‚è±</span> ~2 –º–∏–Ω</span>
              <span class="ob-pill"><span class="ob-pill-ico">ü§ñ</span> –£–º–Ω—ã–π –ø–æ–¥–±–æ—Ä</span>
            </div>
          </div>
        </form>
      </div>

      <!-- Right: showcase (no photos) -->
      <aside class="ob-side" aria-hidden="true">
        <div class="ob-side-glow"></div>

        <div class="ob-float ob-f1">
          <div class="ob-float-card">
            <div class="ob-float-thumb"></div>
            <div class="ob-float-lines">
              <div class="l1"></div><div class="l2"></div><div class="l3"></div>
            </div>
          </div>
        </div>

        <div class="ob-float ob-f2">
          <div class="ob-float-card big">
            <div class="ob-avatar"></div>
            <div class="ob-float-lines">
              <div class="l1"></div><div class="l2"></div><div class="l3"></div>
            </div>
            <div class="ob-badge">‚ù§</div>
          </div>
        </div>

        <div class="ob-float ob-f3">
          <div class="ob-float-card">
            <div class="ob-float-thumb alt"></div>
            <div class="ob-float-lines">
              <div class="l1"></div><div class="l2"></div><div class="l3"></div>
            </div>
          </div>
        </div>

        <div class="ob-spark s1"></div>
        <div class="ob-spark s2"></div>
        <div class="ob-spark s3"></div>
      </aside>

    </div>

    <!-- bottom tiles like in mock -->
    <div class="ob-tiles">
      <div class="ob-tile">
        <div class="ob-tile-ico">üí¨</div>
        <div>
          <div class="ob-tile-title">AI-–∏–Ω—Ç–µ—Ä–≤—å—é</div>
          <div class="ob-tile-sub">–£–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
        </div>
      </div>

      <div class="ob-tile">
        <div class="ob-tile-ico">üß©</div>
        <div>
          <div class="ob-tile-title">–ü–æ–¥–±–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–π</div>
          <div class="ob-tile-sub">–ü–æ–¥ —Ç–≤–æ–∏ —Ü–µ–ª–∏</div>
        </div>
      </div>

      <div class="ob-tile">
        <div class="ob-tile-ico">‚ö°</div>
        <div>
          <div class="ob-tile-title">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</div>
          <div class="ob-tile-sub">30 —Å–µ–∫—É–Ω–¥</div>
        </div>
      </div>
    </div>

  </div>
</section>

<script>
(function(){
  const rolesInput = document.getElementById('rolesInput');
  const chips = document.getElementById('chips');
  const addBtn = document.getElementById('chipAddBtn');

  function normalize(s){
    return (s || '').trim().replace(/\s+/g,' ');
  }

  function parseRoles(){
    const raw = rolesInput.value || '';
    return raw.split(',').map(x => normalize(x)).filter(Boolean);
  }

  function setRoles(arr){
    rolesInput.value = arr.join(', ');
  }

  function render(){
    const roles = parseRoles().slice(0, 3);

    // remove existing chips (except add button)
    [...chips.querySelectorAll('.ob-chip:not(.ob-chip-add)')].forEach(n => n.remove());

    roles.forEach((r, idx) => {
      const chip = document.createElement('button');
      chip.type = 'button';
      chip.className = 'ob-chip';
      chip.innerHTML = `<span class="t">${escapeHtml(r)}</span><span class="x">√ó</span>`;
      chip.addEventListener('click', () => {
        const now = parseRoles().filter(x => x !== r);
        setRoles(now);
        render();
      });
      chips.insertBefore(chip, addBtn);
    });

    // disable add when 3
    addBtn.disabled = roles.length >= 3;
  }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, (m) => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  addBtn.addEventListener('click', () => {
    const roles = parseRoles();
    if (roles.length >= 3) return;

    const val = prompt('–î–æ–±–∞–≤—å —Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: SMM / Data Analyst / –ë–∞—Ä–±–µ—Ä)');
    const v = normalize(val);
    if (!v) return;

    // avoid duplicates
    if (roles.map(x => x.toLowerCase()).includes(v.toLowerCase())) return;

    roles.push(v);
    setRoles(roles);
    render();
  });

  // init: if rolesInput has text ‚Äî render chips
  render();
})();
</script>
{% endblock %}