{% extends "base.html" %}

{% block title %}VECTOR{% endblock %}

{% block content %}

<section class="hero">

    <div class="hero-overlay"></div>

    <div class="hero-content">

        <!-- Маленький логотип -->
        <div class="hero-logo">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="VECTOR AI">
        </div>

        <h1 class="hero-title">
            AI-сопоставление талантов и возможностей
        </h1>

        <p class="hero-subtitle">
            VECTOR AI анализирует навыки, поведенческий профиль и требования рынка,
            чтобы находить точные карьерные совпадения.
        </p>

        <div class="hero-buttons">
            <a href="/student" class="hero-btn primary">Начать как студент</a>
            <a href="/employer" class="hero-btn secondary">Employer Mode</a>
        </div>

    </div>

</section>


<section class="tech-section">

    <div class="tech-row">

        <div class="tech-item">
            <img src="{{ url_for('static', filename='images/icons/ai.png') }}" alt="">
            <span>AI Interview Engine</span>
        </div>

        <div class="tech-item">
            <img src="{{ url_for('static', filename='images/icons/dna.png') }}" alt="">
            <span>Skill-DNA Model</span>
        </div>

        <div class="tech-item">
            <img src="{{ url_for('static', filename='images/icons/api.png') }}" alt="">
            <span>HH API Integration</span>
        </div>

        <div class="tech-item">
            <img src="{{ url_for('static', filename='images/icons/match.png') }}" alt="">
            <span>Semantic Matching</span>
        </div>

    </div>

</section>


<section id="market-section">
    <h2>Рынок труда</h2>

    <div id="marketLoader" class="market-loader">
        <div class="loader-bar">
            <div class="loader-progress" id="loaderProgress"></div>
        </div>
        <p>VECTOR анализирует рынок...</p>
    </div>

    <div id="marketContainer"></div>
</section>




<section class="skill-dna-section">

    <div class="skill-dna-container">

        <!-- LEFT CONTENT -->
        <div class="skill-dna-left">

            <span class="skill-dna-label">CORE TECHNOLOGY</span>

            <h2 class="skill-dna-title">
                Skill-DNA Model
            </h2>

            <p class="skill-dna-description">
                Мы превращаем навыки человека в цифровой профиль,
                который можно точно сопоставить с требованиями рынка труда.
            </p>

            <ul class="skill-dna-features">

                <li>
                    <img src="https://cdn-icons-png.flaticon.com/128/9670/9670967.png" alt="">
                    AI-анализ ответов и поведенческого профиля
                </li>

                <li>
                    <img src="https://cdn-icons-png.flaticon.com/128/3981/3981812.png" alt="">
                    Семантическое сопоставление навыков
                </li>

                <li>
                    <img src="https://cdn-icons-png.flaticon.com/128/1642/1642042.png" alt="">
                    Оценка спроса и конкуренции
                </li>

                <li>
                    <img src="https://cdn-icons-png.flaticon.com/128/3012/3012365.png" alt="">
                    Процент точного карьерного совпадения
                </li>

            </ul>

            <div class="skill-dna-buttons">
                <a href="/student" class="dna-btn primary">Попробовать как студент</a>
                <a href="/employer" class="dna-btn secondary">Employer Mode</a>
            </div>

        </div>

        <!-- RIGHT IMAGE -->
        <div class="skill-dna-right">
            <img src=https://i.ibb.co.com/TDZGnQcy/d68430db-c988-4d80-941b-d1b1f540dcc5.png"
                 alt="AI DNA Technology Visualization"
                 class="skill-dna-image">
        </div>

    </div>

</section>


<section class="semantic-apple">

  <div class="semantic-head">
    <span class="semantic-label">CORE TECHNOLOGY</span>
    <h2 class="semantic-title">Semantic Matching</h2>
    <p class="semantic-sub">
      Сопоставление по смыслу, а не по совпадению слов.
    </p>
  </div>

  <div class="semantic-process">

    <!-- PROFILE -->
    <div class="semantic-step">
      <img src="https://cdn-icons-png.flaticon.com/128/2102/2102647.png" class="semantic-icon">
      <h4>Профиль</h4>
      <p>Python • REST • SQL • Flask</p>
    </div>

    <div class="semantic-line"></div>

    <!-- AI ANALYSIS -->
    <div class="semantic-step highlight">
      <img src="{{ url_for('static', filename='images/icons/ai.png') }}" class="semantic-icon">
      <h4>Контекстный AI анализ</h4>
      <p>Связи навыков и требований</p>
    </div>

    <div class="semantic-line"></div>

    <!-- JOB -->
    <div class="semantic-step">
      <img src="https://cdn-icons-png.flaticon.com/128/5474/5474200.png" class="semantic-icon">
      <h4>Вакансия</h4>
      <p>Backend • API • Database • Logic</p>
    </div>

  </div>

    <div class="semantic-result">

      <div class="semantic-score-head">
        <span>Fit Score</span>
        <strong>87%</strong>
      </div>

            <div class="semantic-progress">
              <div class="semantic-progress-fill" data-percent="87" aria-valuemin="0" aria-valuemax="100" role="progressbar"></div>
            </div>

    </div>

</section>

<section class="employer-radar">

  <div class="radar-header">
    <span>РЕЖИМ РАБОТОДАТЕЛЯ</span>
    <h2>AI Talent Radar</h2>
    <p>Система анализирует вакансию и определяет лучших кандидатов.</p>
  </div>

  <div class="radar-container">

    <!-- LEFT: Вакансия -->
    <div class="radar-vacancy">
      <h4>Вакансия</h4>
      <p>Frontend-разработчик</p>
      <small>React · TypeScript · REST API · Git</small>
    </div>

    <!-- CENTER: Radar -->
    <div class="radar-visual">
        <div class="radar-visual">

          <div class="radar-circle"></div>
          <div class="radar-circle circle-2"></div>
          <div class="radar-circle circle-3"></div>

          <div class="radar-sweep"></div>

          <div class="radar-point center"></div>

          <!-- найденные кандидаты -->
          <div class="target t1"></div>
          <div class="target t2"></div>
          <div class="target t3"></div>

        </div>
    </div>

    <!-- RIGHT: Кандидаты -->
    <div class="radar-output">

            <div class="radar-metric high">
              <span>Аида А.</span>
              <strong>92%</strong>
            </div>

            <div class="radar-metric medium">
              <span>Иманали Ш.</span>
              <strong>87%</strong>
            </div>

            <div class="radar-metric low">
              <span>Асанали А.</span>
              <strong>83%</strong>
            </div>

      <div class="radar-result">
        Рекомендовано: 3 лучших кандидата
      </div>

    </div>

  </div>

</section>

<section class="risk-section">

    <div class="risk-wrapper">

        <!-- HEADER -->
        <header class="risk-header">
            <img src="/static/images/logo.png" alt="VECTOR AI" class="risk-logo">

            <h1 class="risk-title">
                Прогноз устойчивости профессии
            </h1>

            <p class="risk-subtitle">
                VECTOR AI анализирует спрос, конкуренцию и автоматизацию,
                чтобы оценить будущие риски на рынке труда.
            </p>
        </header>


        <!-- SEARCH PANEL -->
        <div class="risk-search">

            <div class="risk-search-input">
                <input
                        type="text"
                        id="professionInput"
                        placeholder="Введите профессию">
                <button onclick="startRiskAnalysis()">
                    Анализировать
                </button>
            </div>

            <!-- LOADER -->
            <div class="risk-loader" id="riskLoader">
                <div class="risk-bar">
                    <div class="risk-progress" id="riskProgress"></div>
                </div>
                <span class="risk-loader-text">
          Анализ данных...
        </span>
            </div>

        </div>


        <!-- RESULT BLOCK -->
        <div class="risk-output" id="riskResult">

            <!-- Default State -->
            <div class="risk-empty-state">
                <img src="https://cdn-icons-png.flaticon.com/128/6745/6745051.png"
                     alt="analysis icon"
                     class="risk-empty-icon">

                <p class="risk-empty-text">
                    Введите профессию, чтобы получить прогноз.
                </p>
            </div>

        </div>

    </div>

</section>

<script>
  // animate semantic progress once when visible
  (function(){
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          const fill = e.target.querySelector('.semantic-progress-fill');
          if (fill && !fill.dataset.animated) {
            const percent = parseInt(fill.datasetPercent || fill.dataset.percent || fill.getAttribute('data-percent') || '87', 10);
            fill.style.width = Math.max(0, Math.min(100, percent)) + '%';
            fill.dataset.animated = '1';
          }
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.35 });

    document.querySelectorAll('.semantic-result').forEach(el => observer.observe(el));
  })();
</script>

<script>
    async function startRiskAnalysis() {

        const profession = document.getElementById("professionInput").value.trim();
        const loader = document.getElementById("riskLoader");
        const progress = document.getElementById("riskProgress");
        const resultBox = document.getElementById("riskResult");

        if (!profession) {
            alert("Введите профессию");
            return;
        }

        resultBox.innerHTML = "";
        loader.style.display = "block";
        progress.style.width = "0%";

        let fake = 0;
        const interval = setInterval(() => {
            fake += 3;
            if (fake >= 90) fake = 90;
            progress.style.width = fake + "%";
        }, 80);

        try {
            const response = await fetch("/api/risk-forecast", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ profession })
            });

            const data = await response.json();

            clearInterval(interval);
            progress.style.width = "100%";

            setTimeout(() => {
                loader.style.display = "none";

                if (data.error) {
                    resultBox.innerHTML = "<p>Ошибка анализа</p>";
                    return;
                }

                const riskColor =
                    data.risk_score > 70 ? "#dc2626" :
                    data.risk_score > 40 ? "#f59e0b" :
                    "#16a34a";

                resultBox.innerHTML = `
                    <div class="risk-card">
                        <h3>${profession}</h3>

                        <div class="risk-score" style="color:${riskColor}">
                            Индекс риска: ${data.risk_score}%
                        </div>

                        <p><strong>Текущий спрос:</strong> ${data.demand}</p>
                        <p><strong>Конкуренция:</strong> ${data.competition}</p>
                        <p><strong>Автоматизация:</strong> ${data.automation}</p>

                        <p class="risk-summary">${data.summary}</p>
                    </div>
                `;
            }, 400);

        } catch (error) {
            clearInterval(interval);
            loader.style.display = "none";
            resultBox.innerHTML = "<p>Ошибка сервера</p>";
        }
    }
</script>

<script>
    /* ===== Иконки по ролям ===== */
    const roleIcons = {

        // Backend — сервер, база данных
        "Backend Developer":
        "https://cdn-icons-png.flaticon.com/512/4248/4248443.png", // server

        // Frontend — интерфейс / браузер
        "Frontend Developer":
        "https://cdn-icons-png.flaticon.com/512/888/888859.png", // web layout / UI

        // Медсестра — медицинский крест
        "Медицинская сестра":
        "https://cdn-icons-png.flaticon.com/512/2966/2966327.png", // medical cross

        // Инженер строитель — каска / строительство
        "Инженер строитель":
        "https://cdn-icons-png.flaticon.com/128/1098/1098346.png", // construction helmet

        // Менеджер по продажам — рост графика / продажи
        "Менеджер по продажам":
        "https://cdn-icons-png.flaticon.com/128/18590/18590868.png" // growth chart
    };

    async function loadMarketAnalytics() {

        const loader = document.getElementById("marketLoader");
        const progress = document.getElementById("loaderProgress");
        const container = document.getElementById("marketContainer");

        if (loader) loader.style.display = "block";
        container.innerHTML = "";

        /* ===== Плавный fake-progress ===== */
        let fakeProgress = 0;
        const interval = setInterval(() => {
            fakeProgress += 4;
            if (fakeProgress >= 92) fakeProgress = 92;
            if (progress) progress.style.width = fakeProgress + "%";
        }, 100);

        try {
            const response = await fetch("/api/market-analytics");
            if (!response.ok) throw new Error("Network error");

            const data = await response.json();

            clearInterval(interval);
            if (progress) progress.style.width = "100%";

            setTimeout(() => {
                if (loader) loader.style.display = "none";
                renderMarket(data.results || []);
            }, 300);

        } catch (error) {
            clearInterval(interval);
            if (loader) loader.style.display = "none";
            console.error("Ошибка загрузки рынка:", error);
            container.innerHTML = "<p>Ошибка загрузки данных.</p>";
        }
    }

    function renderMarket(list) {

        const container = document.getElementById("marketContainer");
        container.innerHTML = "";

        if (!list.length) {
            container.innerHTML = "<p>Нет данных.</p>";
            return;
        }

        /* сортировка по спросу */
        list.sort((a, b) => b.found - a.found);

        list.forEach(item => {

            const iconUrl = roleIcons[item.role] ||
                "https://cdn-icons-png.flaticon.com/512/1828/1828919.png";

            const row = document.createElement("div");
            row.className = "market-row";

            row.innerHTML = `
                <div class="market-header">
                    <img src="${iconUrl}" class="market-icon" alt="">
                    <h3>${item.role}</h3>
                </div>
                <div style="display:flex; align-items:center; gap:20px;">
                    <span class="market-count">
                        ${Number(item.found).toLocaleString()} вакансий
                    </span>
                    <span class="market-heat">
                        ${translateHeat(item.heat)}
                    </span>
                </div>
            `;

            container.appendChild(row);
        });
    }

    function translateHeat(level) {
        if (level === "high") return "Высокий спрос";
        if (level === "medium") return "Средний спрос";
        if (level === "low") return "Низкий спрос";
        return "Нет данных";
    }

    document.addEventListener("DOMContentLoaded", loadMarketAnalytics);
</script>
{% endblock %}